<html>

<head>
<title>Title</title>
</head>

<body>

<p>This is an R HTML document.</p>

<!--begin.rcode
library(caret)
library(randomForest)

Train_pml<-read.csv("C:/DATA SCIENCE SPECIALIZATION/pml-training.csv",header = TRUE,
                    na.strings = c("NA","NaN","","#DIV/0!"))
test_pml<-read.csv("C:/DATA SCIENCE SPECIALIZATION/pml-testing.csv",header = TRUE,
                   na.strings = c("NA","NaN","","#DIV/0!"))

Train_pml2<-Train_pml[,sapply(Train_pml,function(x) !any(is.na(x)))]
test_pml2<-test_pml[,sapply(test_pml,function(x) !any(is.na(x)))]




traini_pml3<-Train_pml2[,c(-1,-2,-5,-6,-60)]
test_pml3<-test_pml2[,c(-1,-2,-5,-6,-60)]

train_pml_pr<-prcomp(traini_pml3,scale.=T)
test_pml_pr<-predict(train_pml_pr,newdata=test_pml3)
test_pml_pr<-as.data.frame(test_pml_pr)

std_dev <- train_pml_pr$sdev
pr_var <- std_dev^2
prop_varex <- pr_var/sum(pr_var)
end.rcode-->

<!--begin.rcode fig.width=7, fig.height=6
plot(cumsum(prop_varex), xlab = "Principal Component",
     ylab = "Cumulative Proportion of Variance Explained",
     type = "b")
end.rcode-->

<!--begin.rcode
cumsum(prop_varex[1:33])

train.data<-data.frame(classe=Train_pml2$classe,train_pml_pr$x)
train.data=train.data[,1:34]


ingbm<-createDataPartition(train.data[,34],p=0.7)[[1]]
train.data2<-train.data[ingbm,]
val.data2<-train.data[-ingbm,]


ref_model<-randomForest(classe~.,data=train.data2,mtry=5,ntree=100)
print(ref_model)
ref_model2<-randomForest(classe~.,data=train.data2,mtry=6,ntree=120)
print(ref_model2)
ref_model3<-randomForest(classe~.,data=train.data2,mtry=4,ntree=150)
print(ref_model3)
ref_model$inbag
pred_rf_val<-predict(ref_model,newdata=val.data2[,-1])
pred_rf_val2<-predict(ref_model2,newdata=val.data2[,-1])
pred_rf_val3<-predict(ref_model3,newdata=val.data2[,-1])
confusionMatrix(pred_rf_val,val.data2[,1])
confusionMatrix(pred_rf_val2,val.data2[,1])
confusionMatrix(pred_rf_val3,val.data2[,1])


ref_model4<-randomForest(classe~.,data=train.data,mtry=5,ntree=100)

print(ref_model4)

rf.predictclass<-predict(ref_model4,newdata=test_pml_pr[,1:33])
print(rf.predictclass)
end.rcode-->



</body>
</html>
